<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. </title>

  <!-- ORIGINAL THEME SOCIAL META  start -->
  <!-- <meta property="og:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. " />

    <meta name="twitter:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. " />

    <meta name="description" content="Automate the creation of ZXP installers for Adobe Creative Cloud Extensions with Gulp.js, the javascript task runner based on Node.js">

    <meta name="description" property="og:description" content="Automate the creation of ZXP installers for Adobe Creative Cloud Extensions with Gulp.js, the javascript task runner based on Node.js" />
    <meta name="twitter:description" content="Automate the creation of ZXP installers for Adobe Creative Cloud Extensions with Gulp.js, the javascript task runner based on Node.js" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@undavide" />
    
    <meta property="og:url" content="http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" /> -->

  <!-- ORIGINAL THEME SOCIAL META  end -->

  <!-- MY OWN SOCIAL META  start -->

  <meta name="twitter:site" content="@undavide">
  <meta name="twitter:creator" content="@undavide">
  <meta name="twitter:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js">

  <meta property="og:url" content="http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca" />

  
  <meta name="twitter:description" content="As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less error prone) the utterly annoying job of building ZXP installers: i.e. w...">
  <meta property="og:description" content="As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less error prone) the utterly annoying job of building ZXP installers: i.e. w...">
  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="/wp-content/uploads/2014/08/gulp.png">
  <meta property="og:image" content="http://localhost:4000/wp-content/uploads/2014/08/gulp.png" />
  

<!-- media_card recommended size: 1200 x 628 -->
  <!-- MY OWN SOCIAL META  end -->


  <meta name="author" content="Davide Barranca" />

  <meta name="copyright" content="Copyright by Davide Barranca. All Rights Reserved." />

  <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
  
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  
  <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

  <link rel="canonical" href="http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/">

  <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

  

  
  <script>
    function UnCryptMailto(s) {
      var n = 0;
      var r = "";
      for (var i = 0; i < s.length; i++) {
        n = s.charCodeAt(i);
        if (n >= 8364) {
          n = 128;
        }
        r += String.fromCharCode(n - 1);
      }
      return r;
    }

    function linkTo_UnCryptMailto(s) {
      location.href = UnCryptMailto(s);
    }
  </script>
  
</head>


    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://localhost:4000"><img alt="Avatar" src="/assets/img/io.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Davide Barranca</strong>
            <span class="my-job-title">Photoshop, etc.</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            <a href="http://localhost:4000" >Blog</a>
            
                
            
                
            
                
            
                
                    <a href="http://localhost:4000/courses/" >Courses</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    

    <p class="about-me">Digital Caveman. Photoshop retoucher and script/panels developer. I am also an author, check the Courses page!</p>

    <ul class="socials">
        <li><a href="https://www.facebook.com/undavide"><svg title="facebook" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li><li><a href="https://twitter.com/undavide"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://github.com/undavide"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <!-- WAS: <a href="mailto:davide.barranca@gmail.com">  -->
            <li><a href="javascript:linkTo_UnCryptMailto('nbjmup;ebwjef/cbssbodbAhnbjm/dpn');" title="Drop me an email"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
         <li><a href="http://localhost:4000/feed.xml"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>
</aside>


            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <article class="post single" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2014-08-13T00:33:57+02:00" itemprop="datePublished">13 Aug, 2014</time></li>
            
                
                <li class="cats">
                    
                        <a href="/categories/CEP/">CEP</a>
                    
                </li>
                
            
        </ul>
        <h2 itemprop="name headline">HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js</h2>
    </header>

    <div class="post-content">
        <p>As a <a href="/2014/05/html-panels-tips-10-packaging-zxp-installers/" title="HTML Panels Tips: #10 Packaging / ZXP Installers">HTML Panels Tips: #10 Packaging / ZXP Installers</a> follow-up, in this tip I will show you how to automate (i.e. make less error prone) the utterly annoying job of building ZXP installers: i.e. with the help of <a href="http://gulpjs.com" title="Gulp.js">Gulp.js</a>, a task runner based on Node.js.</p>

<h2 id="gulpjs">Gulp.js</h2>

<p>If you come from Photoshop scripting like me, you might be pretty green when it comes to the plethora of tools that web developers are used to. Since they often need to perform repetitive tasks (such as compile LESS/SASS stylesheets, minify CSS, lint, uglify and concatenate JS, rename and move files, etc.) some tools known as build tools or <strong>task runners</strong> appeared - a couple of remarkable ones being <a href="http://gruntjs.com" title="Grunt.js">Grunt</a> and <a href="http://gulpjs.com" title="Gulp.js">Gulp</a>.</p>

<p>They do basically the same thing: Grunt is based on configuration, Gulp is (newer, and) code based. If the previous sentence makes no sense to you it doesn’t matter too much - if you want to learn more about task runners I strongly suggest you to watch <a href="http://build-podcast.com/gulp/" title="Gulp on Build Podcast">this screencast</a> made by the great and prolific <a href="https://twitter.com/sayanee_" title="Sayanee on Twitter">@sayanee_</a> from the <a href="http://build-podcast.com" title="Build Podcasts">Build Podcast</a> series (<strong>60 free videos</strong> about all kind of tech tools). Amazing resource, really.</p>

<p>I won’t dig deeper on Gulp here (also because I’m not a task runner expert myself), I will just share the particular code I’m using and that proved to work, explaining what each part does and trying to show a glimpse of the big picture. Hopefully, my workflow is simple enough for you to tweak it to fit your own needs.</p>

<h2 id="requisites">Requisites</h2>

<p>Gulp - like tons of useful stuff - is based on <strong>Node.js</strong> (a platform based on Google Chrome runtimes), so you’d better install it first downloading from the <a href="http://nodejs.org" title="Node.js">Node website</a> if you haven’t already done that. Then, you need to know that there are about <em>88 thousands</em> packages extending Node - which are managed by <a href="http://npmjs.org" title="Node Package Manager">npm</a>, the <strong>Node Package Manager.</strong> Npm is automatically installed alongside Node.js. You must have Gulp installed <em>globally</em> (i.e. not only in your project directory but available everywhere), so fire the Terminal and:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">sudo </span>npm <span class="nb">install</span> <span class="nt">-g</span> gulp</code></pre></figure>

<p>Enter your user password when requested (<code class="language-plaintext highlighter-rouge">sudo</code> is a mandatory step on OSX as far as I know - I can’t say if it’s needed on Windows shell too).</p>

<h2 id="foldersstructure">Folders’ structure</h2>

<p><img src="/wp-content/uploads/2014/08/gulp-dirs.png" alt="Folder structure" /></p>

<p>I will package a hybrid extension - the very same I showed in <a href="/2014/05/html-panels-tips-10-packaging-zxp-installers/" title="HTML Panels Tips: #10 Packaging / ZXP Installers">HTML Panels Tips: #10 Packaging / ZXP Installers</a>. That is, an installer that deploys an HTML Panel, a Mac and Windows specific plugin files and a shared Photoshop script. Please refer to the original post for information about the manual process - here I’ll just automate it. The folder hierarchy is as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">src/</code> contains all the source code; <code class="language-plaintext highlighter-rouge">build/</code> is empty and will contain just the final installer.</li>
  <li>The source for the HTML panel is the <code class="language-plaintext highlighter-rouge">src/com.example.myExtension</code> folder.</li>
  <li>The <code class="language-plaintext highlighter-rouge">src/MXI</code> folder gathers all the assets needed to pack the hybrid extension:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">src/MXI/com.example.myExtension.mxi</code> is the configuration file (<a href="/2014/05/html-panels-tips-10-packaging-zxp-installers/" title="HTML Panels Tips: #10 Packaging / ZXP Installers">info here</a>).</li>
      <li><code class="language-plaintext highlighter-rouge">src/MXI/HTML</code> is empty but will contain the ZXP of the HTML panel.</li>
      <li><code class="language-plaintext highlighter-rouge">src/MXI/MAC</code>, <code class="language-plaintext highlighter-rouge">src/MXI/WIN</code> and <code class="language-plaintext highlighter-rouge">src/MXI/SCRIPT</code> are the plugins and scripts needed by the extension.</li>
    </ul>
  </li>
  <li>Finally, <code class="language-plaintext highlighter-rouge">ucf.jar</code>, <code class="language-plaintext highlighter-rouge">ZXPSignCmd</code> and <code class="language-plaintext highlighter-rouge">myCertificate.p12</code> are the command line tools and the signing certificate that you should well know about.</li>
</ul>

<p>I’ve left alone the <code class="language-plaintext highlighter-rouge">package.json</code> and <code class="language-plaintext highlighter-rouge">gulpfile.js</code> files, which I will disclose in a moment.</p>

<h2 id="setting-up-the-project">Setting up the project</h2>

<p>You can either create yourself the <code class="language-plaintext highlighter-rouge">package.json</code> file with the following content:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gulp-package-demo</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.1.0</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CC Extension packaging with Gulp - DEMO</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Davide Barranca</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">license</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MIT</span><span class="dl">"</span>
<span class="p">}</span></code></pre></figure>

<p>Or let npm do it for you: <code class="language-plaintext highlighter-rouge">cd</code> into the project directory (the root), and</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">npm init</code></pre></figure>

<p>The Node Package Manager will initialise a project asking you few questions; as follows my answers (when there’s none, I just hit enter to confirm the suggested defaults):</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sane defaults.

See <span class="sb">`</span>npm <span class="nb">help </span>json<span class="sb">`</span> <span class="k">for </span>definitive documentation on these fields
and exactly what they <span class="k">do</span><span class="nb">.</span>

Use <span class="sb">`</span>npm <span class="nb">install</span> &lt;pkg&gt; <span class="nt">--save</span><span class="sb">`</span> afterwards to <span class="nb">install </span>a package and
save it as a dependency <span class="k">in </span>the package.json file.

Press ^C at any <span class="nb">time </span>to quit.
name: <span class="o">(</span>Gulp<span class="o">)</span> Gulp-package-demo
version: <span class="o">(</span>0.0.0<span class="o">)</span> 0.1.0
description: CC Extension packaging with Gulp - DEMO
entry point: <span class="o">(</span>index.js<span class="o">)</span>
<span class="nb">test command</span>:
git repository:
keywords:
author: Davide Barranca
license: <span class="o">(</span>BSD-2-Clause<span class="o">)</span> MIT
About to write to /Users/Davide/Google Drive/PACK/Gulp/package.json:

<span class="o">{</span>
  <span class="s2">"name"</span>: <span class="s2">"Gulp-package-demo"</span>,
  <span class="s2">"version"</span>: <span class="s2">"0.1.0"</span>,
  <span class="s2">"description"</span>: <span class="s2">"CC Extension packaging with Gulp - DEMO"</span>,
  <span class="s2">"main"</span>: <span class="s2">"index.js"</span>,
  <span class="s2">"scripts"</span>: <span class="o">{</span>
    <span class="s2">"test"</span>: <span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;&amp; exit 1"</span>
  <span class="o">}</span>,
  <span class="s2">"author"</span>: <span class="s2">"Davide Barranca"</span>,
  <span class="s2">"license"</span>: <span class="s2">"MIT"</span>
<span class="o">}</span>


Is this ok? <span class="o">(</span><span class="nb">yes</span><span class="o">)</span></code></pre></figure>

<p>One way or the other, a <code class="language-plaintext highlighter-rouge">package.json</code> file should be there. Now let’s install (<em>locally</em> – i.e. in this very folder) gulp:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">npm <span class="nb">install</span> <span class="nt">--save-dev</span> gulp</code></pre></figure>

<p>We need two gulp plugins: <a href="https://www.npmjs.org/package/gulp-clean" title="gulp-clean">gulp-clean</a> is for deleting files:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">npm <span class="nb">install</span> <span class="nt">--save-dev</span> gulp-clean</code></pre></figure>

<p>while <a href="https://www.npmjs.org/package/gulp-shell" title="gulp-shell">gulp-shell</a> is a command line interface:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">npm <span class="nb">install</span> <span class="nt">--save-dev</span> gulp-shell</code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">--save-dev</code> flag instructs npm to add these ones as project’s dependencies, automatically modifying the json file for you:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gulp-package-demo</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.1.0</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CC Extension packaging with Gulp - DEMO</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Davide Barranca</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">license</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MIT</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">devDependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">gulp</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">~3.8.7</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">gulp-shell</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">~0.2.9</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">gulp-clean</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">~0.3.1</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>You’ll see that npm has installed these dependencies in a <code class="language-plaintext highlighter-rouge">node_modules</code> folder.</p>

<h2 id="gulpfilejs">gulpfile.js</h2>

<p>Here comes the fun: the <code class="language-plaintext highlighter-rouge">gulpfile.js</code> is where you start defining tasks, that you’ll be calling from the Terminal. Before digging into the actual, entire workflow, let’s familiarize with <strong>tasks</strong> - here’s a simple one:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">gulp</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">clean</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">gulp-clean</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// clean all ZXP files found everywhere</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">clean-all</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="dl">'</span><span class="s1">./**/*.zxp</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">read</span><span class="p">:</span> <span class="kc">false</span> <span class="p">})</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">clean</span><span class="p">());</span>
<span class="p">});</span></code></pre></figure>

<p>You first <code class="language-plaintext highlighter-rouge">require</code> gulp, then call the <code class="language-plaintext highlighter-rouge">gulp.task</code> function. The first parameter is the task name as a string (here <code class="language-plaintext highlighter-rouge">'clean-all'</code>), the second is the function that will return a <em>Stream</em> (if you feel inclined, find <a href="https://github.com/substack/stream-handbook" title="Node.js Stream handbook">here</a> info about Streams). Don’t worry too much about that: what you need to know is just that you usually define a gulp source (here every zxp file from any subdirectory) and you pipe that to the <code class="language-plaintext highlighter-rouge">clean</code> function - which deletes files. The <code class="language-plaintext highlighter-rouge">{ read: false }</code> is a configuration object that instructs gulp not to read them, to speed up the process. How do you call that task? In the Terminal (root folder):</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">gulp clean-all</code></pre></figure>

<p>And presto! all the ZXPs that might have been around are gone. Here is another useful task - it uses the <code class="language-plaintext highlighter-rouge">gulp-shell</code> plugin to call the <code class="language-plaintext highlighter-rouge">ZXPSignCmd</code> command line and actually pack files:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">gulp-shell</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// pack the HTML panel using ZXPSignCmd</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">pack-html</span><span class="dl">'</span><span class="p">,</span>  
	<span class="nx">shell</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">./ZXPSignCmd -sign src/com.example.myExtension src/com.example.myExtension.zxp myCertificate.p12 myPassword -tsa https://timestamp.geotrust.com/tsa</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// don't put the semicolon here or it will break!</span>
<span class="p">);</span></code></pre></figure>

<p>If you run in the Terminal:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">gulp pack-html</code></pre></figure>

<p>it is like if you had typed the whole, long ZXPSignCmd string yourself. Hopefully you start appreciating the power of task runners now.</p>

<h2 id="combining-tasks">Combining tasks…</h2>

<p>A task can rely on other tasks - <strong>dependencies</strong> are defined into an array of tasks:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">pack-html</span><span class="dl">'</span><span class="p">,</span> <span class="err">\</span><span class="p">[</span><span class="dl">'</span><span class="s1">clean-all</span><span class="dl">'</span><span class="err">\</span><span class="p">].</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">shell</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">./ZXPSignCmd -sign src/com.example.myExtension src/com.example.myExtension.zxp myCertificate.p12 myPassword -tsa https://timestamp.geotrust.com/tsa</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>In the above example, the <code class="language-plaintext highlighter-rouge">'clean-all'</code> task is performed <em>first</em>, then the <code class="language-plaintext highlighter-rouge">'pack-html'</code> task runs. If you have multiple dependencies (that is: your task needs to run after <em>several</em> other tasks) you can define them this way:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-task</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">first-dep</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">second-dep</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span></code></pre></figure>

<p>Mind you: while the <code class="language-plaintext highlighter-rouge">'test-task'</code> actually runs after <code class="language-plaintext highlighter-rouge">'first-dep'</code> and <code class="language-plaintext highlighter-rouge">'second-dep'</code>, you cannot be sure that <code class="language-plaintext highlighter-rouge">'first-dep'</code> and <code class="language-plaintext highlighter-rouge">'second-dep'</code> are executed in this very order! Dependencies are processed <strong>asynchronously</strong>: <code class="language-plaintext highlighter-rouge">'second-dep'</code> may finish before <code class="language-plaintext highlighter-rouge">'first-dep'</code>.</p>

<h2 id="-synchronously">… synchronously!</h2>

<p>But in the ZXP automation we need to be sure that a task is done <em>before</em> the next one starts - i.e. the whole thing must be <strong>synchronous</strong>. There are few ways to trick gulp into this behaviour: returning a stream, defining a callback, using promises and - the easiest one and therefore my preferred - <strong>chaining dependencies</strong>:</p>

<ul>
  <li>Task #4 depends on Task #3</li>
  <li>Task #3 depends on Task #2</li>
  <li>Task #2 depends on Task #1</li>
</ul>

<p>You run Task #4 and in fact the whole sequence is #1 &gt; #2 &gt; #3 &gt; #4. There might be more elegant ways to get there, but this approach has the advantage of being easily testable: if the result isn’t what you’d expect, just run Task #3 to test the gulpfile up to that point; if it’s still broken, try Task #2, and so on, until you find the bugged task.</p>

<h2 id="complete-gulpfilejs">Complete gulpfile.js</h2>

<p>Given the folder structure I’ve outlined, the entire gulpfile is as follows:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/84f231d7b47a7772cceef0923dd15718.js"> </script>

<p>Hopefully the code and the comments are self-explanatory. Few caveats that might save you some search time on Google:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">'./**/*.zxp'</code> is a way to mean: every zxp file in every subfolder of the root (being the root <code class="language-plaintext highlighter-rouge">'./'</code>).</li>
  <li>For a reason that I don’t know, a semicolon after the <code class="language-plaintext highlighter-rouge">shell.task()</code> breaks gulp.</li>
  <li><code class="language-plaintext highlighter-rouge">{ read: false }</code> speeds up the process when you don’t need gulp to read files.</li>
  <li><code class="language-plaintext highlighter-rouge">{ base: './src/' }</code> (as used in task #2) tells gulp to use <code class="language-plaintext highlighter-rouge">./src/</code> as a base for the relative paths. If you omit it or set it to the root <code class="language-plaintext highlighter-rouge">'./'</code>, you’ll end up with <code class="language-plaintext highlighter-rouge">/src/MXI/HTML/src/com.example.myExtension.zxp</code> (and extra <code class="language-plaintext highlighter-rouge">/src/</code>) and not <code class="language-plaintext highlighter-rouge">/src/MXI/HTML/com.example.myExtension.zxp</code> which is what you actually want.</li>
</ul>

<p>This tip just scratches the surface of gulp.js as a task runner for CC Extensions - I hope to have time to dig deeper and share my findings again - feel free to add yours in the comments!</p>

<hr />

<h3 id="the-photoshop-html-panels-development-course">The Photoshop HTML Panels Development Course</h3>

<figure class="alignleft">
  <a href="https://htmlpanelsbook.com" target="_blank">
	<img src="/wp-content/uploads/2016/03/BookVideo.jpg" alt="Photoshop HTML Panels Development course" /></a>
	<figcaption>Updated to CC 2019.</figcaption>
</figure>

<p>If you’re reading here, you might be interested in my Photoshop Panels development – so let me inform you that I’ve authored a full course:</p>

<ul>
  <li><strong>300 pages</strong> PDF</li>
  <li><strong>3 hours</strong> of HD screencasts</li>
  <li><strong>28 custom Panels</strong> with commented code</li>
</ul>

<p><a href="http://htmlpanelsbook.com">Check it out!</a> Please help me spread the news – I’ll be able to keep producing more exclusive content on this blog. Thank you!</p>


    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js&p[summary]=As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less error prone)...&p[url]=http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/&text=As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less error prone)...&hashtags=HTML Panels Tips,automation," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
                <li><a href="http://localhost:4000/tag/HTML Panels Tips">HTML Panels Tips</a></li>
                
                <li><a href="http://localhost:4000/tag/automation">automation</a></li>
                
            </ul>
        </div>
        
    </footer>
</article>


<aside class="comments" role="complementary">
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = 'http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/';
            this.page.identifier = '8/13/2014';
        };
        (function() {
            var d = document, s = d.createElement('script');

            s.src = '//davidebarranca.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</aside>


            </main>
        </div>

        <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/backtotop.js"></script>
<script src="http://localhost:4000/assets/js/lunr.min.js"></script>
<script src="http://localhost:4000/assets/js/lunr-feed.js"></script>
<script src="http://localhost:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://localhost:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://localhost:4000/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-25716894-1', 'auto');
        ga('send', 'pageview');
    </script>


 <script id="dsq-count-scr" src="//davidebarranca.disqus.com/count.js" async></script>

    </body>
</html>