<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. </title>
    <meta property="og:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. " />
    <meta name="twitter:title" content="HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js | Davide Barranca &mdash; Photoshop, etc. " />

    <meta name="description" content="Digital Caveman. Photoshop retoucher and script/panels developer. I also publish courses, check the Books page!">
    <meta name="description" property="og:description" content="Digital Caveman. Photoshop retoucher and script/panels developer. I also publish courses, check the Books page!" />
    <meta name="twitter:description" content="Digital Caveman. Photoshop retoucher and script/panels developer. I also publish courses, check the Books page!" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@undavide" />
    
    <meta property="og:url" content="http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Davide Barranca" />

    <meta name="copyright" content="Copyright by Davide Barranca. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

    <link rel="canonical" href="http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/">

    <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    
</head>


    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://localhost:4000"><img alt="Avatar" src="/assets/img/io.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Davide Barranca</strong>
            <span class="my-job-title">Photoshop, etc.</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            <a href="http://localhost:4000" >Home</a>
            
                
            
                
            
                
            
                
                    <a href="http://localhost:4000/books/" >Books</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    

    <p class="about-me">Digital Caveman. Photoshop retoucher and script/panels developer. I also publish courses, check the Books page!</p>

    <ul class="socials">
        <li><a href="https://www.facebook.com/undavide"><svg title="facebook" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li><li><a href="https://twitter.com/undavide"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://github.com/undavide"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <li><a href="mailto:davide.barranca@gmail.com"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
         <li><a href="http://localhost:4000/feed.xml"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>
</aside>

            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <article class="post single" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2014-08-13T00:33:57+02:00" itemprop="datePublished">13 Aug, 2014</time></li>
            
        </ul>
        <h2 itemprop="name headline">HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js</h2>
    </header>

    <div class="post-content">
        <div class="pf-content">
  <p>
    As a <a title="HTML Panels Tips: #10 Packaging / ZXP Installers" href="http://localhost:8888/2014/05/html-panels-tips-10-packaging-zxp-installers/" rel="bookmark">HTML Panels Tips: #10 Packaging / ZXP Installers</a> follow-up, in this tip I will show you how to automate (i.e. make less error prone) the utterly annoying job of building ZXP installers: i.e. with the help of <a title="Gulp.js" href="http://gulpjs.com" target="_blank">Gulp.js</a>, a task runner based on Node.js.
  </p>
  
  <h2>
    Gulp.js
  </h2>
  
  <p>
    If you come from Photoshop scripting like me, you might be pretty green when it comes to the plethora of tools that web developers are used to. Since they often need to perform repetitive tasks (such as compile LESS/SASS stylesheets, minify CSS, lint, uglify and concatenate JS, rename and move files, etc.) some tools known as build tools or <strong>task runners</strong> appeared &#8211; a couple of remarkable ones being <a title="Grunt.js" href="http://gruntjs.com" target="_blank">Grunt</a> and <a title="Gulp.js" href="http://gulpjs.com" target="_blank">Gulp</a>.
  </p>
  
  <p>
    They do basically the same thing: Grunt is based on configuration, Gulp is (newer, and) code based. If the previous sentence makes no sense to you it doesn&#8217;t matter too much &#8211; if you want to learn more about task runners I strongly suggest you to watch <a title="Gulp on Build Podcast" href="http://build-podcast.com/gulp/" target="_blank">this screencast</a> made by the great and prolific <a title="Sayanee on Twitter" href="https://twitter.com/sayanee_" target="_blank">@sayanee_</a> from the <a title="Build Podcasts" href="http://build-podcast.com" target="_blank">Build Podcast</a> series (<strong>60 free videos</strong> about all kind of tech tools). Amazing resource, really.
  </p>
  
  <p>
    I won&#8217;t dig deeper on Gulp here (also because I&#8217;m not a task runner expert myself), I will just share the particular code I&#8217;m using and that proved to work, explaining what each part does and trying to show a glimpse of the big picture. Hopefully, my workflow is simple enough for you to tweak it to fit your own needs.
  </p>
  
  <h2>
    Requisites
  </h2>
  
  <p>
    Gulp &#8211; like tons of useful stuff &#8211; is based on <strong>Node.js</strong> (a platform based on Google Chrome runtimes), so you&#8217;d better install it first downloading from the <a title="Node.js" href="http://nodejs.org" target="_blank">Node website</a> if you haven&#8217;t already done that.
  </p>
  
  <p>
    Then, you need to know that there are about <em>88 thousands</em> packages extending Node &#8211; which are managed by <a title="Node Package Manager" href="http://npmjs.org" target="_blank">npm</a>, the <strong>Node Package Manager.</strong> Npm is automatically installed alongside Node.js.
  </p>
  
  <p>
    You must have Gulp installed <em>globally</em> (i.e. not only in your project directory but available everywhere), so fire the Terminal and:
  </p>
  
  <pre class="lang:js highlight:0 decode:true">sudo npm install -g gulp</pre>
  
  <p>
    Enter your user password when requested (<code>sudo</code> is a mandatory step on OSX as far as I know &#8211; I can&#8217;t say if it&#8217;s needed on Windows shell too).
  </p>
  
  <h2>
    Folders&#8217; structure
  </h2>
  
  <p>
    <img class="alignleft size-full wp-image-2697" src="http://localhost:8888/wp-content/uploads/2014/08/gulp-dirs.png" alt="Folder structure" width="290" height="488" srcset="http://localhost:8888/wp-content/uploads/2014/08/gulp-dirs.png 290w, http://localhost:8888/wp-content/uploads/2014/08/gulp-dirs-150x252.png 150w, http://localhost:8888/wp-content/uploads/2014/08/gulp-dirs-178x300.png 178w" sizes="(max-width: 290px) 100vw, 290px" />
  </p>
  
  <p>
    I will package a hybrid extension &#8211; the very same I showed in <a title="HTML Panels Tips: #10 Packaging / ZXP Installers" href="http://localhost:8888/2014/05/html-panels-tips-10-packaging-zxp-installers/" rel="bookmark">HTML Panels Tips: #10 Packaging / ZXP Installers</a>. That is, an installer that deploys an HTML Panel, a Mac and Windows specific plugin files and a shared Photoshop script. Please refer to the original post for information about the manual process &#8211; here I&#8217;ll just automate it.
  </p>
  
  <p>
    The folder hierarchy is as follows:
  </p>
  
  <ul>
    <li>
      <code>src/</code> contains all the source code; <code>build/</code> is empty and will contain just the final installer.
    </li>
    <li>
      The source for the HTML panel is the <code>src/com.example.myExtension</code> folder.
    </li>
    <li>
      The <code>src/MXI</code> folder gathers all the assets needed to pack the hybrid extension: <ul>
        <li>
          <code>src/MXI/com.example.myExtension.mxi</code> is the configuration file (<a title="HTML Panels Tips: #10 Packaging / ZXP Installers" href="http://localhost:8888/2014/05/html-panels-tips-10-packaging-zxp-installers/" rel="bookmark">info here</a>).
        </li>
        <li>
          <code>src/MXI/HTML</code> is empty but will contain the ZXP of the HTML panel.
        </li>
        <li>
          <span style="color: rgba(0, 0, 0, 0.74902);"><code>src/MXI/MAC</code>, <code>src/MXI/WIN</code> and <code>src/MXI/SCRIPT</code> are the plugins and scripts needed by the extension.</span>
        </li>
      </ul>
    </li>
    
    <li>
      Finally, <code>ucf.jar</code>, <code>ZXPSignCmd</code> and <code>myCertificate.p12</code> are the command line tools and the signing certificate that you should well know about.
    </li>
  </ul>
  
  <p>
    I&#8217;ve left alone the <code>package.json</code> and <code>gulpfile.js</code> files, which I will disclose in a moment.
  </p>
  
  <h2>
    Setting up the project
  </h2>
  
  <p>
    You can either create yourself the <code>package.json</code> file with the following content:
  </p>
  
  <pre class="lang:js decode:true">{
  "name": "Gulp-package-demo",
  "version": "0.1.0",
  "description": "CC Extension packaging with Gulp - DEMO",
  "author": "Davide Barranca",
  "license": "MIT"
}</pre>
  
  <p>
    Or let npm do it for you: <code style="line-height: 18px;">cd</code> into the project directory (the root), and
  </p>
  
  <pre class="lang:js highlight:0 decode:true ">npm init</pre>
  
  <p>
    The Node Package Manager will initialise a project asking you few questions; as follows my answers (when there&#8217;s none, I just hit enter to confirm the suggested defaults):
  </p>
  
  <pre class="height-set:true height:200 lang:js highlight:0 decode:true">This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sane defaults.

See `npm help json` for definitive documentation on these fields
and exactly what they do.

Use `npm install &lt;pkg&gt; --save` afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any time to quit.
name: (Gulp) Gulp-package-demo
version: (0.0.0) 0.1.0
description: CC Extension packaging with Gulp - DEMO
entry point: (index.js) 
test command: 
git repository: 
keywords: 
author: Davide Barranca
license: (BSD-2-Clause) MIT
About to write to /Users/Davide/Google Drive/PACK/Gulp/package.json:

{
  "name": "Gulp-package-demo",
  "version": "0.1.0",
  "description": "CC Extension packaging with Gulp - DEMO",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "Davide Barranca",
  "license": "MIT"
}


Is this ok? (yes)</pre>
  
  <p>
    One way or the other, a <code>package.json</code> file should be there. Now let&#8217;s install (<em>locally</em> &#8211; i.e. in this very folder) gulp:
  </p>
  
  <pre class="lang:js highlight:0 decode:true">npm install --save-dev gulp</pre>
  
  <p>
    We need two gulp plugins: <a title="gulp-clean" href="https://www.npmjs.org/package/gulp-clean" target="_blank">gulp-clean</a> is for deleting files:
  </p>
  
  <pre class="lang:js highlight:0 decode:true">npm install --save-dev gulp-clean</pre>
  
  <p>
    while <a title="gulp-shell" href="https://www.npmjs.org/package/gulp-shell" target="_blank">gulp-shell</a> is a command line interface:
  </p>
  
  <pre class="lang:js highlight:0 decode:true">npm install --save-dev gulp-shell</pre>
  
  <p>
    The <code>--save-dev</code> flag instructs npm to add these ones as project&#8217;s dependencies, automatically modifying the json file for you:
  </p>
  
  <pre class="lang:js decode:true">{
  "name": "Gulp-package-demo",
  "version": "0.1.0",
  "description": "CC Extension packaging with Gulp - DEMO",
  "author": "Davide Barranca",
  "license": "MIT",
  "devDependencies": {
    "gulp": "~3.8.7",
    "gulp-shell": "~0.2.9",
    "gulp-clean": "~0.3.1"
  }
}</pre>
  
  <p>
    You&#8217;ll see that npm has installed these dependencies in a <code>node_modules</code> folder.
  </p>
  
  <h2>
    gulpfile.js
  </h2>
  
  <p>
    Here comes the fun: the <code>gulpfile.js</code> is where you start defining tasks, that you&#8217;ll be calling from the Terminal. Before digging into the actual, entire workflow, let&#8217;s familiarize with <strong>tasks</strong> &#8211; here&#8217;s a simple one:
  </p>
  
  <pre class="lang:js decode:true">var gulp = require('gulp'); 
var clean = require('gulp-clean');

// clean all ZXP files found everywhere
gulp.task('clean-all', function () {
	return gulp.src('./**/*.zxp', { read: false })
	.pipe(clean());
});</pre>
  
  <p>
    You first <code>require</code> gulp, then call the <code>gulp.task</code> function. The first parameter is the task name as a string (here <code>'clean-all'</code>), the second is the function that will return a <em>Stream</em> (if you feel inclined, find <a title="Node.js Stream handbook" href="https://github.com/substack/stream-handbook" target="_blank">here</a> info about Streams).
  </p>
  
  <p>
    Don&#8217;t worry too much about that: what you need to know is just that you usually define a gulp source (here every zxp file from any subdirectory) and you pipe that to the <code>clean</code> function &#8211; which deletes files. The <code>{ read: false }</code> is a configuration object that instructs gulp not to read them, to speed up the process.
  </p>
  
  <p>
    How do you call that task? In the Terminal (root folder):
  </p>
  
  <pre class="lang:js highlight:0 decode:true">gulp clean-all</pre>
  
  <p>
    And presto! all the ZXPs that might have been around are gone.
  </p>
  
  <p>
    Here is another useful task &#8211; it uses the <code>gulp-shell</code> plugin to call the <span style="color: rgba(0, 0, 0, 0.74902);"><code>ZXPSignCmd</code> </span>command line and actually pack files:
  </p>
  
  <pre class="lang:js decode:true">var shell = require('gulp-shell');

// pack the HTML panel using ZXPSignCmd
gulp.task('pack-html',  
	shell.task('./ZXPSignCmd -sign src/com.example.myExtension src/com.example.myExtension.zxp myCertificate.p12 myPassword -tsa https://timestamp.geotrust.com/tsa') // don't put the semicolon here or it will break!
);</pre>
  
  <p>
    If you run in the Terminal:
  </p>
  
  <pre class="lang:js highlight:0 decode:true ">gulp pack-html</pre>
  
  <p>
    it is like if you had typed the whole, long ZXPSignCmd string yourself. Hopefully you start appreciating the power of task runners now.
  </p>
  
  <h2>
    Combining tasks&#8230;
  </h2>
  
  <p>
    A task can rely on other tasks &#8211; <strong>dependencies</strong> are defined into an array of tasks:
  </p>
  
  <pre class="lang:js decode:true ">gulp.task('pack-html', ['clean-all']. function () {
	shell.task('./ZXPSignCmd -sign src/com.example.myExtension src/com.example.myExtension.zxp myCertificate.p12 myPassword -tsa https://timestamp.geotrust.com/tsa')
}</pre>
  
  <p>
    In the above example, the <code>'clean-all'</code> task is performed <em>first</em>, then the <code>'pack-html'</code> task runs.
  </p>
  
  <p>
    If you have multiple dependencies (that is: your task needs to run after <em>several</em> other tasks) you can define them this way:
  </p>
  
  <pre class="lang:js decode:true">gulp.task('test-task', ['first-dep', 'second-dep'], function () {
    //...
}</pre>
  
  <p>
    Mind you: while the <code>'test-task'</code> actually runs after <code>'first-dep'</code> and <code>'second-dep'</code>, you cannot be sure that <code>'first-dep'</code> and <code>'second-dep'</code> are executed in this very order! Dependencies are processed <strong>asynchronously</strong>: <span style="color: rgba(0, 0, 0, 0.74902);"><code>'second-dep'</code> may finish before <code>'first-dep'</code>.</span>
  </p>
  
  <h2>
    &#8230; synchronously!
  </h2>
  
  <p>
    But in the ZXP automation we need to be sure that a task is done <em>before</em> the next one starts &#8211; i.e. the whole thing must be <strong>synchronous</strong>. There are few ways to trick gulp into this behaviour: returning a stream, defining a callback, using promises and &#8211; the easiest one and therefore my preferred &#8211; <strong>chaining dependencies</strong>:
  </p>
  
  <ul>
    <li>
      Task #4 depends on Task #3
    </li>
    <li>
      Task #3 depends on Task #2
    </li>
    <li>
      Task #2 depends on Task #1
    </li>
  </ul>
  
  <p>
    You run Task #4 and in fact the whole sequence is #1 &gt; #2 &gt; #3 &gt; #4.
  </p>
  
  <p>
    There might be more elegant ways to get there, but this approach has the advantage of being easily testable: if the result isn&#8217;t what you&#8217;d expect, just run Task #3 to test the gulpfile up to that point; if it&#8217;s still broken, try Task #2, and so on, until you find the bugged task.
  </p>
  
  <h2>
    Complete gulpfile.js
  </h2>
  
  <p>
    Given the folder structure I&#8217;ve outlined, the entire gulpfile is as follows:
  </p>
  
  <pre class="lang:js decode:true">var gulp = require('gulp'); 
var clean = require('gulp-clean');
var shell = require('gulp-shell');

// 0. Clean all ZXPs found everywhere
gulp.task('clean-all', function () {
	return gulp.src('./**/*.zxp', { read: false })
	.pipe(clean());
});

// 1. Build the HTML Panel ZXP in src/
gulp.task('pack-html',  
	shell.task('./ZXPSignCmd -sign src/com.example.myExtension src/com.example.myExtension.zxp myCertificate.p12 myPassword -tsa https://timestamp.geotrust.com/tsa')
);

// 2. Copy the ZXP in src/ to src/MXI/HTML/
gulp.task('move-html-zxp', ['pack-html'], function (){
	return gulp.src('./src/*.zxp', { base: './src/' })
	.pipe(gulp.dest('./src/MXI/HTML'));
});

// 3. Delete the HTML Panel ZXP in src/
gulp.task('clean-html-zxp', ['move-html-zxp'], function () {
	return gulp.src('./src/*.zxp', { read: false })
	.pipe(clean());
});

// 4. Build the hybrid ZXP in src/
gulp.task('pack-hybrid-zxp', ['clean-html-zxp'], 
	shell.task('java -jar ucf.jar -package -storetype PKCS12 -keystore ./myCertificate.p12 -storepass myPassword -tsa http://timestamp.entrust.net/TSS/JavaHttpTS com.example.myExtension.zxp -C "./src/MXI/" .')
);

// 5. Copy the hybrid ZXP to build/
gulp.task('move-zxp-to-build', ['pack-hybrid-zxp'], function () {
	return gulp.src('./*.zxp', { base: './' })
	.pipe(gulp.dest('build'));
});

// 6. Delete the hybrid ZXP in src/
gulp.task('clean-hybrid-zxp', ['move-zxp-to-build'], function () {
	return gulp.src('./*.zxp', { read: false })
	.pipe(clean());
});

// 7. Define the default task
gulp.task('default', ['clean-all'], function () {
	gulp.start('clean-hybrid-zxp');
});</pre>
  
  <p>
    Hopefully the code and the comments are self-explanatory. Few caveats that might save you some search time on Google:
  </p>
  
  <ul>
    <li>
      <code>'./**/*.zxp'</code> is a way to mean: every zxp file in every subfolder of the root (being the root <code>'./'</code>).
    </li>
    <li>
      For a reason that I don&#8217;t know, a semicolon after the <code>shell.task()</code> breaks gulp.
    </li>
    <li>
      <code>{ read: false }</code> speeds up the process when you don&#8217;t need gulp to read files.
    </li>
    <li>
      <code>{ base: './src/' }</code> (as used in task #2) tells gulp to use <code>./src/</code> as a base for the relative paths. If you omit it or set it to the root <code>'./'</code>, you&#8217;ll end up with <code>/src/MXI/HTML/src/com.example.myExtension.zxp</code> (and extra <code>/src/</code>) and not <code>/src/MXI/HTML/com.example.myExtension.zxp</code> which is what you actually want.
    </li>
  </ul>
  
  <p>
    This tip just scratches the surface of gulp.js as a task runner for CC Extensions &#8211; I hope to have time to dig deeper and share my findings again &#8211; feel free to add yours in the comments!
  </p>
</div>

<!-- Share-Widget Button BEGIN -->
<p>&lt;a href=”javascript:void(0);” myshare_id=”mys_shareit” myshare_url=”http://localhost:8888/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/” myshare_title=”HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js” rel=”nofollow” onclick=” return false;” style=”text-decoration:none; color:#000000; font-size:11px; line-height:20px;”&gt;</p>

<p><img src="http://localhost:8888/wp-content/plugins/share-widget/img/share-button-white-small.png" height="20" alt="Share" style="border:0" /> &lt;/a&gt; <!-- Share-Widget Button END --></p>

    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=HTML Panels Tips: #13 Automate ZXP Packaging with Gulp.js&p[summary]=
  
    As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less erro...&p[url]=http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/&text=
  
    As a HTML Panels Tips: #10 Packaging / ZXP Installers follow-up, in this tip I will show you how to automate (i.e. make less erro...&hashtags=build tool,CC Extension,gulp,task runner,ZXP," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
                <li><a href="http://localhost:4000/tag/build tool">build tool</a></li>
                
                <li><a href="http://localhost:4000/tag/CC Extension">CC Extension</a></li>
                
                <li><a href="http://localhost:4000/tag/gulp">gulp</a></li>
                
                <li><a href="http://localhost:4000/tag/task runner">task runner</a></li>
                
                <li><a href="http://localhost:4000/tag/ZXP">ZXP</a></li>
                
            </ul>
        </div>
        
    </footer>
</article>


<aside class="comments" role="complementary">
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = 'http://localhost:4000/2014/08/html-panels-tips-13-automate-zxp-packaging-with-gulp-js/';
            this.page.identifier = '8/13/2014';
        };
        (function() {
            var d = document, s = d.createElement('script');

            s.src = '//your_disqus_site.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</aside>

            </main>
        </div>

        <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/backtotop.js"></script>
<script src="http://localhost:4000/assets/js/lunr.min.js"></script>
<script src="http://localhost:4000/assets/js/lunr-feed.js"></script>
<script src="http://localhost:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://localhost:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://localhost:4000/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-XXXXXXX-2', 'auto');
        ga('send', 'pageview');
    </script>

    </body>
</html>