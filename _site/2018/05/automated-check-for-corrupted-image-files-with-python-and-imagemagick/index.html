<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Automated check for corrupted image files with Python and ImageMagick | Davide Barranca &mdash; Photoshop, etc. </title>

  <!-- ORIGINAL THEME SOCIAL META  start -->
  <!-- <meta property="og:title" content="Automated check for corrupted image files with Python and ImageMagick | Davide Barranca &mdash; Photoshop, etc. " />

    <meta name="twitter:title" content="Automated check for corrupted image files with Python and ImageMagick | Davide Barranca &mdash; Photoshop, etc. " />

    <meta name="description" content="How to automatically batch a file corruption and integrity check for psd, psb, tiff and jpg image files with Python and ImageMagick.">

    <meta name="description" property="og:description" content="How to automatically batch a file corruption and integrity check for psd, psb, tiff and jpg image files with Python and ImageMagick." />
    <meta name="twitter:description" content="How to automatically batch a file corruption and integrity check for psd, psb, tiff and jpg image files with Python and ImageMagick." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@undavide" />
    
    <meta property="og:url" content="http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" /> -->

  <!-- ORIGINAL THEME SOCIAL META  end -->

  <!-- MY OWN SOCIAL META  start -->

  <meta name="twitter:site" content="@undavide">
  <meta name="twitter:creator" content="@undavide">
  <meta name="twitter:title" content="Automated check for corrupted image files with Python and ImageMagick">

  <meta property="og:url" content="http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Automated check for corrupted image files with Python and ImageMagick | Davide Barranca" />

  
  <meta name="twitter:description" content="How to automatically batch a file corruption and integrity check for psd, psb, tiff and jpg image files with Python and ImageMagick.">
  <meta property="og:description" content="How to automatically batch a file corruption and integrity check for psd, psb, tiff and jpg image files with Python and ImageMagick.">
  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="/wp-content/uploads/2018/05/corrupted.png">
  <meta property="og:image" content="http://localhost:4000/wp-content/uploads/2018/05/corrupted.png" />
  

<!-- media_card recommended size: 1200 x 628 -->
  <!-- MY OWN SOCIAL META  end -->


  <meta name="author" content="Davide Barranca" />

  <meta name="copyright" content="Copyright by Davide Barranca. All Rights Reserved." />

  <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
  
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  
  <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

  <link rel="canonical" href="http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/">

  <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

  

  
  <script>
    function UnCryptMailto(s) {
      var n = 0;
      var r = "";
      for (var i = 0; i < s.length; i++) {
        n = s.charCodeAt(i);
        if (n >= 8364) {
          n = 128;
        }
        r += String.fromCharCode(n - 1);
      }
      return r;
    }

    function linkTo_UnCryptMailto(s) {
      location.href = UnCryptMailto(s);
    }
  </script>
  
</head>


    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://localhost:4000"><img alt="Avatar"
                src="/assets/img/io.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Davide Barranca</strong>
            <span class="my-job-title">Photoshop, etc.</span>
        </div>
    </div>

    
    
    <div class="mainmenu">
        <a href="http://localhost:4000" >Blog</a>
        
        
        
        
        
        
        
        
        <a href="http://localhost:4000/courses/" >Courses 📙</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <!-- <p class="about-me">Digital Caveman. Photoshop retoucher and plugins developer. Check out my Courses page!</p> -->
    <div>
        <a href="https://www.ps-scripting.com/professional-ps-uxp.html"><img alt="Adobe UXP plugins development"
                src="/assets/img/UXP@2x.png" width="250" height="294" /></a>
    </div>

    <ul class="socials">
        <li><a href="https://www.facebook.com/undavide"><svg
                    title="facebook" width="16" height="16" >
                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                        xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon">
                    </use>
                </svg></a></li><li><a href="https://twitter.com/undavide"><svg
                    title="twitter" width="16" height="16" >
                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                        xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon">
                    </use>
                </svg></a></li><li><a href="https://github.com/undavide"><svg
                    title="github" width="16" height="16" >
                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                        xlink:href="http://localhost:4000/assets/svg/social-icons.svg#github-icon">
                    </use>
                </svg></a></li>

        
        <!-- WAS: <a href="mailto:davide.barranca@gmail.com">  -->
        <li><a href="javascript:linkTo_UnCryptMailto('nbjmup;ebwjef/cbssbodbAhnbjm/dpn');" title="Drop me an email"><svg
                    title="" width="16" height="16">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                        xlink:href="http://localhost:4000/assets/svg/social-icons.svg#email-icon">
                    </use>
                </svg></a></li>
        

        
        <li><a href="http://localhost:4000 /feed.xml"><svg title=""
                    width="16" height="16">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                        xlink:href="http://localhost:4000/assets/svg/social-icons.svg#rss-icon"></use>
                </svg></a></li>
        
    </ul>
</aside>

            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <article class="post single" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2018-05-08T02:20:19+02:00" itemprop="datePublished">8 May, 2018</time></li>
            
                
                <li class="cats">
                    
                        <a href="/categories/Coding/">Coding</a>
                    
                </li>
                
            
        </ul>
        <h2 itemprop="name headline">Automated check for corrupted image files with Python and ImageMagick</h2>
    </header>

    <div class="post-content">
        <p>How do you check if an image file (tiff, psd, psb) is corrupted, other than looking at its thumbnail with Bridge, or opening it on Photoshop? With a small Python script and ImageMagick!</p>

<h2 id="background">Background</h2>

<p>The client of mine I work as a retoucher for had some problems with the so-called <em>Data Migration</em> (the dull, time consuming, and error prone process of transferring a lifetime backup from old, once very expensive external drives to a set of new, somehow still equally expensive external drives). As a result, he got some corrupted files here and there in the destination drives – that’s the reason why you <em>migrate</em> data: the source has insufficient capacity, it has become unstable, obsolete, or both combined. Problem is that we’re talking about several TB of data, mostly as .psb files (ranging from about 1 up to 20GB each), and it goes without saying that opening them all in Photoshop is not an option; nor you can trust Adobe Bridge thumbnails – provided that you’ve set the preferences to render previews for big files too – because it’s a manual process anyway. Even if I’m paid by the hour, staring at thumbs is not my preferred way to get blind. After some research, I’ve found no way (other than the one I’m about to describe) to check for psd/psb files corruption in an automated fashion. Which seems to me quite odd – if you have better, i.e. faster and/or simpler, solutions, please do suggest them to me in the comments below.</p>

<h2 id="what-you-need">What you need</h2>

<p><a href="https://www.python.org/download/releases/3.0/">Python 3</a>, and <a href="https://www.imagemagick.org/">ImageMagick</a>. Both will work either on Mac or Windows: I’ve no experience of them on the latter platform, so I will just assume that you will be successful in following the installation instruction provided in the official home pages. PC owners: read at least the part relative to ImageMagick. Mac users: read it all.</p>

<h3 id="python-3">Python 3</h3>

<p>If you’re on a Mac like me, you already have Python installed. Chances are that it is version 2.7, or another one but 3. Open the Terminal and type:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python <span class="nt">--version</span>
Python 2.7.10</code></pre></figure>

<p>This is what I still get after having installed Python 3.6 myself, via <a href="https://brew.sh/index_it">Homebrew</a>. I’m no Python expert, so it took me some Google time to understand that on a Mac you can still have the <code class="language-plaintext highlighter-rouge">python</code> command pointing to the System’s old 2.7 version, even if you’ve freshly installed the new one. Solutions involve manually changing symlinks (power users advise against it), or using one of the available packages to create isolate Python environments (e.g. <a href="https://virtualenv.pypa.io/en/stable/">virtualenv</a>, <a href="https://github.com/pyenv/pyenv">pyenv</a>, etc. A list of them is found <a href="https://stackoverflow.com/questions/41573587/what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe">here</a>). I couldn’t make neither of them to work in a reasonable amount of time, so I’ve resorted to simply use the <code class="language-plaintext highlighter-rouge">python3</code> command, e.g.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python3 <span class="nt">--version</span>
Python 3.6.2</code></pre></figure>

<h3 id="imagemagick">ImageMagick</h3>

<p><a href="https://www.imagemagick.org/">ImageMagick</a> is a multiplatform, open source commandline utility that performs a huge amount of tasks on all kinds of image files. I’ve installed via Homebrew, but it turns out that, at least on the Mac, it doesn’t come by default with the proper Delegates (aka Libraries) to deal with .psb files, which is what I needed the most. Finding the proper way to do so proved almost impossible to me: while reading the source code documentation (the last thing I wanted to do was to compile it from the source), I’ve discovered that via Homebrew you can list all the possible installation options for a package:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>brew options imagemagick

<span class="nt">--with-fftw</span>
  Compile with FFTW support
<span class="nt">--with-fontconfig</span>
  Build with fontconfig support
<span class="nt">--with-ghostscript</span>
  Build with ghostscript support
<span class="nt">--with-hdri</span>
  Compile with HDRI support
<span class="nt">--with-liblqr</span>
  Build with liblqr support
<span class="nt">--with-librsvg</span>
  Build with librsvg support
<span class="nt">--with-libwmf</span>
  Build with libwmf support
<span class="nt">--with-little-cms</span>
  Build with little-cms support
<span class="nt">--with-little-cms2</span>
  Build with little-cms2 support
<span class="nt">--with-opencl</span>
  Compile with OpenCL support
<span class="nt">--with-openexr</span>
  Build with openexr support
<span class="nt">--with-openjpeg</span>
  Build with openjpeg support
<span class="nt">--with-openmp</span>
  Compile with OpenMP support
<span class="nt">--with-pango</span>
  Build with pango support
<span class="nt">--with-perl</span>
  Compile with PerlMagick
<span class="nt">--with-webp</span>
  Build with webp support
<span class="nt">--with-x11</span>
  Build with x11 support
<span class="nt">--with-zero-configuration</span>
  Disables depending on XML configuration files
<span class="nt">--without-freetype</span>
  Build without freetype support
<span class="nt">--without-jpeg</span>
  Build without jpeg support
<span class="nt">--without-libpng</span>
  Build without libpng support
<span class="nt">--without-libtiff</span>
  Build without libtiff support
<span class="nt">--without-magick-plus-plus</span>
  disable build/install of Magick++
<span class="nt">--without-modules</span>
  Disable support <span class="k">for </span>dynamically loadable modules
<span class="nt">--without-threads</span>
  Disable threads support
<span class="nt">--HEAD</span>
  Install HEAD version</code></pre></figure>

<p>So, after a first installation (without psb support), with no clear hint about the proper option(s) to use in my case, and even less spare time to test, I’ve chained them all – at least the seemingly appropriate ones, with little worries about being redundant. At all events, no one was watching me, nor would have ever known :-) The embarrassing line I’ve used is:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>brew reinstall imagemagick  <span class="nt">--with-fftw</span> <span class="nt">--with-fontconfig</span> <span class="nt">--with-ghostscript</span> <span class="nt">--with-hdri</span> <span class="nt">--with-libde265</span> <span class="nt">--with-liblqr</span> <span class="nt">--with-librsvg</span> <span class="nt">--with-libwmf</span> <span class="nt">--with-little-cms</span> <span class="nt">--with-little-cms2</span> <span class="nt">--with-opencl</span> <span class="nt">--with-openexr</span> <span class="nt">--with-openjpeg</span> <span class="nt">--with-openmp</span> <span class="nt">--with-pango</span> <span class="nt">--with-perl</span> <span class="nt">--with-webp</span> <span class="nt">--with-x11</span></code></pre></figure>

<p>It worked, so I was a happy camper.</p>

<h2 id="the-python-script">The Python Script</h2>

<p>Which is far from perfect, but it does the job – I’m sure that a proper Python developer can make it much better: it comes from surgical copy&amp;paste from various Google Search result, plus a very light editing on my side.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>

<span class="n">folderToCheck</span> <span class="o">=</span> <span class="s">'/Volumes/16TB/whatever/path'</span>
<span class="n">fileExtension</span> <span class="o">=</span> <span class="s">'.psb'</span>

<span class="k">def</span> <span class="nf">checkImage</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
  <span class="n">proc</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span>\<span class="p">[</span><span class="s">'identify'</span><span class="p">,</span> <span class="s">'-verbose'</span><span class="p">,</span> <span class="n">fn</span>\<span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
  <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">communicate</span><span class="p">()</span>
  <span class="n">exitcode</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">returncode</span>
  <span class="k">return</span> <span class="n">exitcode</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span>

<span class="k">for</span> <span class="n">directory</span><span class="p">,</span> <span class="n">subdirectories</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folderToCheck</span><span class="p">):</span>
  <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">fileExtension</span><span class="p">):</span>
      <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
      <span class="n">code</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">checkImage</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span><span class="s">"0"</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"ERROR "</span> <span class="o">+</span> <span class="n">filePath</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"OK "</span> <span class="o">+</span> <span class="n">filePath</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"-------------- DONE --------------"</span><span class="p">);</span></code></pre></figure>

<h3 id="how-it-works">How it works</h3>

<p>The basic is the <code class="language-plaintext highlighter-rouge">identify</code> call (that comes from ImageMagick), which is set to <code class="language-plaintext highlighter-rouge">-verbose</code>. This is what performs the check: the rest is just looping through the filesystem, looking for the appropriate file extension, and logging a message.</p>

<h3 id="how-to-use-it">How to use it</h3>

<p>Save this on a file with a <code class="language-plaintext highlighter-rouge">.py</code> extension, and then run it with the <code class="language-plaintext highlighter-rouge">python3</code> command on a terminal, e.g.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python3 check.py</code></pre></figure>

<p>Before doing so, do change the content of the <code class="language-plaintext highlighter-rouge">folderToCheck</code> variable with an actual folder on your disk (with absolute path), and the <code class="language-plaintext highlighter-rouge">fileExtension</code> too: I’ve used <code class="language-plaintext highlighter-rouge">.psb</code>, but you can change it to <code class="language-plaintext highlighter-rouge">.psd</code>, <code class="language-plaintext highlighter-rouge">.tif</code>, <code class="language-plaintext highlighter-rouge">.jpg</code>, etc. As a result you’ll get a log in the Terminal; I’ve used a nifty, cheap application called <a href="https://coderunnerapp.com/">Code Runner</a> for such tests, and this is the result:</p>

<p><img src="/wp-content/uploads/2018/05/coderunner-700x426.png" alt="" /></p>

<p>As you see, I’m just logging OK/ERROR with the path, very basic. What to do with this newly acquired piece of knowledge is up to you. Please note that:</p>

<ul>
  <li>The script processes nested folders too.</li>
  <li>It is <em>awfully slow</em> and hungry: it eats CPU cycles and RAM. But it’s automatic, so heck!</li>
  <li>The file extension is case sensitive, so <code class="language-plaintext highlighter-rouge">".JPG"</code> is different from <code class="language-plaintext highlighter-rouge">".jpg"</code>.</li>
</ul>

<h3 id="how-to-make-it-better">How to make it better</h3>

<p>Few suggestions for the skilled Python developer (which I’m not, alas)</p>

<ul>
  <li>Write on a log file instead of the console</li>
  <li>Keep track of the processing status and resume from there</li>
  <li>Display the advancement status (say, “image 34 of 320”)</li>
  <li>Make the file extension case insensitive.</li>
</ul>

<p>If you know how to do any of this, please share your knowledge in the comments! Thank you!</p>

    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Automated check for corrupted image files with Python and ImageMagick&p[summary]=How do you check if an image file (tiff, psd, psb) is corrupted, other than looking at its thumbnail with Bridge, or opening it on Photos...&p[url]=http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/&text=How do you check if an image file (tiff, psd, psb) is corrupted, other than looking at its thumbnail with Bridge, or opening it on Photos...&hashtags=Python,imagemagick," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
                <li><a href="http://localhost:4000/tag/Python">Python</a></li>
                
                <li><a href="http://localhost:4000/tag/imagemagick">imagemagick</a></li>
                
            </ul>
        </div>
        
    </footer>
</article>


<aside class="comments" role="complementary">
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = 'http://localhost:4000/2018/05/automated-check-for-corrupted-image-files-with-python-and-imagemagick/';
            this.page.identifier = '5/8/2018';
        };
        (function() {
            var d = document, s = d.createElement('script');

            s.src = '//davidebarranca.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</aside>


            </main>
        </div>

        <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/backtotop.js"></script>
<script src="http://localhost:4000/assets/js/lunr.min.js"></script>
<script src="http://localhost:4000/assets/js/lunr-feed.js"></script>
<script src="http://localhost:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://localhost:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://localhost:4000/assets/js/scripts.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DBN9GHS9Z4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DBN9GHS9Z4');
</script>


 <script id="dsq-count-scr" src="//davidebarranca.disqus.com/count.js" async></script>

    </body>
</html>